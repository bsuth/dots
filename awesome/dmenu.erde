local awful = require('awful')
local { global_keys } = require('core.bindings')
local Object = require('core.Object')
local Menu = require('components.Menu')
local veil = require('veil')

local HOME_DMENU_OPTIONS = {
  {
    label = 'system',
    options = {
      { label = 'lock', action = 'slock' },
      { label = 'sleep', action = 'systemctl suspend' },
      { label = 'reboot', action = '/sbin/reboot' },
      { label = 'poweroff', action = '/sbin/poweroff' },
    },
  },
  {
    label = 'gpick',
    action = () -> awful.spawn.with_shell("gpick -s -o | tr -d '\\n' | xclip -sel c")
  },
  { label = 'flameshot', action = 'flameshot gui' },
  { label = 'simplescreenrecorder', action = 'simplescreenrecorder' },
  { label = 'firefox', action = 'firefox-developer-edition' },
  {
    label = 'apps',
    options = {
      { label = 'inkscape', action = 'inkscape' },
      { label = 'discord', action = 'discord' },
      { label = 'aseprite', action = 'aseprite' },
      { label = 'godot', action = 'godot' },
    },
  },
}

local menu = Object(Menu, {
  options = HOME_DMENU_OPTIONS, -- TODO: work options
  on_close = veil.hide,
  on_submit = { action } -> {
    if type(action) == 'string' {
      awful.spawn(action)
    } elseif type(action) == 'function' {
      action()
    }
  },
})

table.insert(global_keys, awful.key({ 'Mod4' }, 'space', () -> {
  veil.show(menu.root_widget)
  menu:run()
}))
